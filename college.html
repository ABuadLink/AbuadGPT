<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ABUAD AI College Chat</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0 }
    body {
      font-family: "Segoe UI", sans-serif;
      background: #121212; color: #eee;
      display: flex; flex-direction: column; height:100vh; overflow:hidden;
    }
    header {
      background: #004f97; color:white;
      padding:12px; display:flex; align-items:center; user-select:none;
    }
    #backBtn {
      font-size:1.4rem; cursor:pointer; margin-right:12px;
    }
    #collegeName {
      flex:1; text-align:center;
    }
    .chat-container {
      flex:1; overflow-y:auto;
      padding:12px; display:flex; flex-direction:column; gap:10px;
      background:#1a1a1a;
    }
    .message {
      max-width:70%; padding:12px 16px; border-radius:20px;
      line-height:1.4; font-size:1rem; word-wrap:break-word;
    }
    .user {
      align-self:flex-end; background:#1e8e3e; color:white;
      border-bottom-right-radius:6px;
    }
    .ai {
      align-self:flex-start; background:#333; color:#ddd;
      border-bottom-left-radius:6px;
    }
    .input-area {
      display:flex; padding:12px; background:#222;
    }
    .input-area input {
      flex:1; padding:12px; font-size:1rem;
      border:none; outline:none; color:#eee;
      background:#333; border-radius:20px;
    }
    .input-area input::placeholder { color:#bbb; }
    .input-area button {
      margin-left:8px; padding:0 18px;
      background:#1e8e3e; border:none;
      color:white; font-size:1rem;
      border-radius:20px; cursor:pointer;
      transition: background .2s;
    }
    .input-area button:disabled { background:#555; cursor:not-allowed; }
    .input-area button:hover:not(:disabled) { background:#166622; }
    /* loading spinner */
    .spinner {
      width:24px; height:24px;
      border:3px solid #555;
      border-top:3px solid #1e8e3e;
      border-radius:50%;
      animation:spin 1s linear infinite;
      align-self:flex-start;
    }
    @keyframes spin { 0% { transform:rotate(0);} 100% {transform:rotate(360deg);} }
    .chat-container::-webkit-scrollbar {
      width:8px;
      background:transparent;
    }
    .chat-container::-webkit-scrollbar-thumb {
      background:#666; border-radius:4px;
    }
  </style>
</head>
<body>
  <header>
    <div id="backBtn" title="Back" role="button">←</div>
    <div id="collegeName">Loading...</div>
  </header>

  <main class="chat-container" id="chatContainer"></main>

  <form class="input-area" id="chatForm">
    <input id="messageInput" type="text" placeholder="Ask anything…" autocomplete="off" required>
    <button type="submit">Send</button>
  </form>

  <script>
    // Your OpenRouter API key:
    const API_KEY = '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';

    const chatContainer = document.getElementById('chatContainer');
    const chatForm = document.getElementById('chatForm');
    const messageInput = document.getElementById('messageInput');
    const collegeNameDiv = document.getElementById('collegeName');
    const backBtn = document.getElementById('backBtn');

    const college = localStorage.getItem('selectedCollege') || 'Unknown College';
    collegeNameDiv.textContent = college;

    backBtn.addEventListener('click', () => window.location.href = 'index.html');

    function appendMessage(text, sender) {
      const div = document.createElement('div');
      div.className = 'message ' + sender;
      div.textContent = text;
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function askGPT(question) {
      const endpoint = 'https://openrouter.ai/api/v1/chat/completions';
      const payload = {
        model: 'gpt-4o',
        messages: [
          { role:'system', content:`You are ABUAD college assistant. College: ${college}.` },
          { role:'user', content: question }
        ],
        temperature:0.7, max_tokens:600
      };
      try {
        const res = await fetch(endpoint, {
          method:'POST',
          headers:{ 'Content-Type':'application/json', 'Authorization':`Bearer ${API_KEY}` },
          body:JSON.stringify(payload)
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.error?.message || res.statusText);
        return data.choices[0].message.content.trim();
      } catch(e) {
        console.error(e);
        return '⚠️ Error: ' + (e.message || 'Please try again later.');
      }
    }

    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = messageInput.value.trim();
      if (!text) return;

      appendMessage(text, 'user');
      messageInput.value = '';
      messageInput.disabled = true;
      chatForm.querySelector('button').disabled = true;

      const spinner = document.createElement('div');
      spinner.className = 'spinner';
      chatContainer.appendChild(spinner);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      const reply = await askGPT(text);

      spinner.remove();
      appendMessage(reply, 'ai');

      messageInput.disabled = false;
      chatForm.querySelector('button').disabled = false;
      messageInput.focus();
    });
  </script>
</body>
</html>
